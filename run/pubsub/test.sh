set -o errexit   # abort on nonzero exitstatus
set -o nounset   # abort on unbound variable
set -o pipefail  # don't hide errors within pipes

# SUCCEEDED: daily_usage_metrics_summary
echo -n '{"message":{"attributes":{"eventType":"TRANSFER_RUN_FINISHED","payloadFormat":"JSON_API_V1"},"data":"ewogICJkYXRhU291cmNlSWQiOiAic2NoZWR1bGVkX3F1ZXJ5IiwKICAiZGVzdGluYXRpb25EYXRhc2V0SWQiOiAiY3Jvbl9tb25pdG9yaW5nIiwKICAiZW1haWxQcmVmZXJlbmNlcyI6IHsKICAgICJlbmFibGVGYWlsdXJlRW1haWwiOiB0cnVlCiAgfSwKICAiZW5kVGltZSI6ICIyMDIzLTA0LTA0VDIwOjE0OjE4LjIyMDI2OFoiLAogICJlcnJvclN0YXR1cyI6IHsKICAKICB9LAogICJuYW1lIjogInByb2plY3RzLzg5MjIzMDIzNDUzMi9sb2NhdGlvbnMvdXMvdHJhbnNmZXJDb25maWdzLzY0MGY2OWY5LTAwMDAtMjc1Ny1iMTIzLTk0ZWIyYzFjZTYyYy9ydW5zLzY0NDA5ZmY3LTAwMDAtMmRkMC04MzhhLWY0MDMwNDM2NTJlYyIsCiAgIm5vdGlmaWNhdGlvblB1YnN1YlRvcGljIjogInByb2plY3RzL3dwZS1wbGF0Zm9ybS1vbmUtZGV2L3RvcGljcy9jcm9uLW1vbml0b3JpbmciLAogICJwYXJhbXMiOiB7CiAgICAiZGVzdGluYXRpb25fdGFibGVfbmFtZV90ZW1wbGF0ZSI6ICJkYWlseV91c2FnZV9tZXRyaWNzX3N1bW1hcnkiLAogICAgInF1ZXJ5IjogIlNFTEVDVFxuICBEQVRFX0FERChAcnVuX2RhdGUsIElOVEVSVkFMIC0xIERBWSkgQVMgZGF0ZSxcbiAgcDFhX3Jvd19jb3VudCxcbiAgcDFhX2xhc3Rfd2Vla19yb3dfY291bnQsXG4gIGNtZGJfYWN0aXZlX2luc3RhbGxzX2NvdW50LFxuICAoXG4gICAgQ0FTRSBXSEVOIHAxYV9sYXN0X3dlZWtfcm93X2NvdW50IFx1MDAzZSAwIFRIRU4gKFxuICAgICAgQUJTKHAxYV9yb3dfY291bnQgLSBwMWFfbGFzdF93ZWVrX3Jvd19jb3VudCkgLyBwMWFfbGFzdF93ZWVrX3Jvd19jb3VudCAqIDEwMC4wXG4gICAgKSBFTFNFIE5VTEwgRU5EXG4gICkgQVMgcDFhX3dlZWtseV9kaWZmX3BlcmNlbnRhZ2UsXG4gIChcbiAgICBDQVNFIFdIRU4gY21kYl9hY3RpdmVfaW5zdGFsbHNfY291bnQgXHUwMDNlIDAgVEhFTiAoXG4gICAgICBBQlMocDFhX3Jvd19jb3VudCAtIGNtZGJfYWN0aXZlX2luc3RhbGxzX2NvdW50KSAvIGNtZGJfYWN0aXZlX2luc3RhbGxzX2NvdW50ICogMTAwLjBcbiAgICApIEVMU0UgTlVMTCBFTkRcbiAgKSBBUyBwMWFfY21kYl9kaWZmX3BlcmNlbnRhZ2VcbkZST00gKFxuICBTRUxFQ1RcbiAgKFxuICAgIFNFTEVDVFxuICAgICAgcDFhX3Jvd19jb3VudFxuICAgIEZST01cbiAgICAgIEVYVEVSTkFMX1FVRVJZKFxuICAgICAgICBcIndwZS1wbGF0Zm9ybS1vbmUtZGV2LnVzLnBsYXRmb3JtLW9uZS1kZXYtcmVwbGljYVwiLFxuICAgICAgICBcIlNFTEVDVCBkYXRlLCBjb3VudCgqKSBhcyBwMWFfcm93X2NvdW50IEZST00gdXNhZ2VfbWV0cmljcyBncm91cCBieSBkYXRlO1wiXG4gICAgICApXG4gICAgV0hFUkVcbiAgICAgIGRhdGUgPSBEQVRFX0FERChAcnVuX2RhdGUsIElOVEVSVkFMIC0xIGRheSlcbiAgKSBBUyBwMWFfcm93X2NvdW50LFxuICAoXG4gICAgU0VMRUNUXG4gICAgICBwMWFfcm93X2NvdW50IEFTIHAxYV9sYXN0X3dlZWtfcm93X2NvdW50XG4gICAgRlJPTVxuICAgICAgYHdwZS1wbGF0Zm9ybS1vbmUtZGV2LmNyb25fbW9uaXRvcmluZy5kYWlseV91c2FnZV9tZXRyaWNzX3N1bW1hcnlgXG4gICAgV0hFUkVcbiAgICAgIGRhdGUgPSBEQVRFX0FERChAcnVuX2RhdGUsIElOVEVSVkFMIC04IERBWSlcbiAgICBMSU1JVFxuICAgICAgMVxuICApIEFTIHAxYV9sYXN0X3dlZWtfcm93X2NvdW50LFxuICAoXG4gICAgU0VMRUNUXG4gICAgICBDT1VOVCgqKSBBUyBjbWRiX2FjdGl2ZV9pbnN0YWxsc19jb3VudFxuICAgIEZST01cbiAgICAgIGB3cC1lbmdpbmUtZGV2ZWxvcG1lbnQuY3VzdG9tZXJfbWFzdGVyLnZpZXdfYWNjb3VudF9pbnN0YWxsYFxuICAgIFdIRVJFXG4gICAgICBpbnN0YWxsX2NhbmNlbGVkX29uIElTIE5VTExcbiAgICAgIEFORCBhY2NvdW50X2NhbmNlbGVkX29uIElTIE5VTExcbiAgICAgIEFORCBpbnN0YWxsX2NyZWF0ZWRfb24gXHUwMDNjIHRpbWVzdGFtcF9hZGQoQHJ1bl90aW1lLCBJTlRFUlZBTCAtMiBkYXkpXG4gICkgQVMgY21kYl9hY3RpdmVfaW5zdGFsbHNfY291bnRcbik7XG4iLAogICAgIndyaXRlX2Rpc3Bvc2l0aW9uIjogIldSSVRFX0FQUEVORCIKICB9LAogICJydW5UaW1lIjogIjIwMjMtMDQtMDRUMjA6MTM6MDEuODQ2WiIsCiAgInNjaGVkdWxlVGltZSI6ICIyMDIzLTA0LTA0VDIwOjEzOjAzLjAwMzYyMloiLAogICJzdGFydFRpbWUiOiAiMjAyMy0wNC0wNFQyMDoxMzowMy4xNTU4NzVaIiwKICAic3RhdGUiOiAiU1VDQ0VFREVEIiwKICAidXBkYXRlVGltZSI6ICIyMDIzLTA0LTA0VDIwOjE0OjE4LjIyMDI5NloiLAogICJ1c2VySWQiOiAiMzg0MzAxODU1OTQxMzIyMTAxMiIKfQo=","messageId":"7345725633090832","message_id":"7345725633090832","publishTime":"2023-04-04T20:14:18.361Z","publish_time":"2023-04-04T20:14:18.361Z"},"subscription":"projects/wpe-platform-one-dev/subscriptions/bigquery-slack-notifier"}' | http post localhost:8080

# FAILED: cmdb_p1adb_count_comparison
echo -n '{"message":{"attributes":{"eventType":"TRANSFER_RUN_FINISHED","payloadFormat":"JSON_API_V1"},"data":"ewogICJkYXRhU291cmNlSWQiOiAic2NoZWR1bGVkX3F1ZXJ5IiwKICAiZGVzdGluYXRpb25EYXRhc2V0SWQiOiAiY3Jvbl9tb25pdG9yaW5nIiwKICAiZW1haWxQcmVmZXJlbmNlcyI6IHsKICAgICJlbmFibGVGYWlsdXJlRW1haWwiOiB0cnVlCiAgfSwKICAiZW5kVGltZSI6ICIyMDIzLTA0LTA0VDIwOjE0OjIwLjM1NzIzNFoiLAogICJlcnJvclN0YXR1cyI6IHsKICAgICJjb2RlIjogMywKICAgICJtZXNzYWdlIjogIk9uIDIwMjMtMDQtMDMgdGhlIGRpZmZlcmVuY2UgYmV0d2VlbiBDTURCIFx1MDAyNiBQMUEgREIgbWV0cmljcyBpcyBvZiA5OS45NTM5NTMxMjQyODA1MTclOyBKb2JJRDogODkyMjMwMjM0NTMyOnNjaGVkdWxlZF9xdWVyeV82NDJmNDU2Mi0wMDAwLTI3ZWEtOTBkYS05NGViMmMxYWVkOTgiCiAgfSwKICAibmFtZSI6ICJwcm9qZWN0cy84OTIyMzAyMzQ1MzIvbG9jYXRpb25zL3VzL3RyYW5zZmVyQ29uZmlncy82NDAzYzA3NC0wMDAwLTJkOTEtODNhNC05NGViMmMxYmUxNTIvcnVucy82NDJmNDU2Mi0wMDAwLTI3ZWEtOTBkYS05NGViMmMxYWVkOTgiLAogICJub3RpZmljYXRpb25QdWJzdWJUb3BpYyI6ICJwcm9qZWN0cy93cGUtcGxhdGZvcm0tb25lLWRldi90b3BpY3MvY3Jvbi1tb25pdG9yaW5nIiwKICAicGFyYW1zIjogewogICAgImRlc3RpbmF0aW9uX3RhYmxlX25hbWVfdGVtcGxhdGUiOiAiY21kYl9wMWFkYl9jb3VudF9jb21wYXJpc29uIiwKICAgICJxdWVyeSI6ICJTRUxFQ1RcbiAgZGF0ZSxcbiAgQ0FTRSBXSEVOIHAxYV9jbWRiX2RpZmZfcGVyY2VudGFnZSBJUyBOVUxMIFRIRU4gRVJST1IoXG4gICAgQ09OQ0FUKFxuICAgICAgJ09uICcsXG4gICAgICBkYXRlLFxuICAgICAgJyB0aGUgZGlmZmVyZW5jZSBiZXR3ZWVuIENNREIgXHUwMDI2IFAxQSBEQiBtZXRyaWNzIHdhcyBub3QgY2FsY3VsYXRlZCAnXG4gICAgKVxuICApXG4gIFdIRU4gcDFhX2NtZGJfZGlmZl9wZXJjZW50YWdlIFx1MDAzZSAxIFRIRU4gRVJST1IoXG4gICAgQ09OQ0FUKFxuICAgICAgJ09uICcsXG4gICAgICBkYXRlLFxuICAgICAgJyB0aGUgZGlmZmVyZW5jZSBiZXR3ZWVuIENNREIgXHUwMDI2IFAxQSBEQiBtZXRyaWNzIGlzIG9mICcsXG4gICAgICBwMWFfY21kYl9kaWZmX3BlcmNlbnRhZ2UsXG4gICAgICAnJSdcbiAgICApXG4gICkgRUxTRSBwMWFfY21kYl9kaWZmX3BlcmNlbnRhZ2UgRU5EXG5GUk9NXG4gIChcbiAgICBTRUxFQ1RcbiAgICAgIERBVEVfQUREKEBydW5fZGF0ZSwgSU5URVJWQUwgLTEgREFZKSBBUyBkYXRlLFxuICAgICAgdy5wMWFfY21kYl9kaWZmX3BlcmNlbnRhZ2VcbiAgICBGUk9NXG4gICAgICBgd3BlLXBsYXRmb3JtLW9uZS1kZXYuY3Jvbl9tb25pdG9yaW5nLmRhaWx5X3VzYWdlX21ldHJpY3Nfc3VtbWFyeWAgQVMgd1xuICAgIFdIRVJFXG4gICAgICB3LmRhdGUgPSBEQVRFX0FERChAcnVuX2RhdGUsIElOVEVSVkFMIC0xIERBWSlcbiAgKTtcbiIsCiAgICAid3JpdGVfZGlzcG9zaXRpb24iOiAiV1JJVEVfQVBQRU5EIgogIH0sCiAgInJ1blRpbWUiOiAiMjAyMy0wNC0wNFQyMDoxMzowNC43NzdaIiwKICAic2NoZWR1bGVUaW1lIjogIjIwMjMtMDQtMDRUMjA6MTM6MDUuMTMxNTc5WiIsCiAgInN0YXJ0VGltZSI6ICIyMDIzLTA0LTA0VDIwOjEzOjA1LjI1NjQ5NFoiLAogICJzdGF0ZSI6ICJGQUlMRUQiLAogICJ1cGRhdGVUaW1lIjogIjIwMjMtMDQtMDRUMjA6MTQ6MjAuMzU3Mjc0WiIsCiAgInVzZXJJZCI6ICIzODQzMDE4NTU5NDEzMjIxMDEyIgp9Cg==","messageId":"7345662780681464","message_id":"7345662780681464","publishTime":"2023-04-04T20:14:20.486Z","publish_time":"2023-04-04T20:14:20.486Z"},"subscription":"projects/wpe-platform-one-dev/subscriptions/bigquery-slack-notifier"}' | http post localhost:8080

# FAILED: p1adb_current_vs_last_week_comparison
echo -n '{"message":{"attributes":{"eventType":"TRANSFER_RUN_FINISHED","payloadFormat":"JSON_API_V1"},"data":"ewogICJkYXRhU291cmNlSWQiOiAic2NoZWR1bGVkX3F1ZXJ5IiwKICAiZGVzdGluYXRpb25EYXRhc2V0SWQiOiAiY3Jvbl9tb25pdG9yaW5nIiwKICAiZW1haWxQcmVmZXJlbmNlcyI6IHsKICAgICJlbmFibGVGYWlsdXJlRW1haWwiOiB0cnVlCiAgfSwKICAiZW5kVGltZSI6ICIyMDIzLTA0LTA0VDIwOjE0OjIzLjk5NDE1MloiLAogICJlcnJvclN0YXR1cyI6IHsKICAgICJjb2RlIjogMywKICAgICJtZXNzYWdlIjogIk9uIDIwMjMtMDQtMDMgdGhlIGRpZmZlcmVuY2UgYmV0d2VlbiB0aGlzIHdlZWsgYW5kIGxhc3Qgd2VlayBtZXRyaWNzIHdhcyBub3QgY2FsY3VsYXRlZCA7IEpvYklEOiA4OTIyMzAyMzQ1MzI6c2NoZWR1bGVkX3F1ZXJ5XzY0NDJjMDViLTAwMDAtMmRlYS1iOTc2LWY0MDMwNDVmMjYyZSIKICB9LAogICJuYW1lIjogInByb2plY3RzLzg5MjIzMDIzNDUzMi9sb2NhdGlvbnMvdXMvdHJhbnNmZXJDb25maWdzLzY0MTBmYWVmLTAwMDAtMjAyOS05NDBlLTk0ZWIyYzFjNWUwNi9ydW5zLzY0NDJjMDViLTAwMDAtMmRlYS1iOTc2LWY0MDMwNDVmMjYyZSIsCiAgIm5vdGlmaWNhdGlvblB1YnN1YlRvcGljIjogInByb2plY3RzL3dwZS1wbGF0Zm9ybS1vbmUtZGV2L3RvcGljcy9jcm9uLW1vbml0b3JpbmciLAogICJwYXJhbXMiOiB7CiAgICAiZGVzdGluYXRpb25fdGFibGVfbmFtZV90ZW1wbGF0ZSI6ICJwMWFkYl9jdXJyZW50X3ZzX2xhc3Rfd2Vla19jb21wYXJpc29uIiwKICAgICJxdWVyeSI6ICIgIFNFTEVDVFxuICBkYXRlLFxuICBDQVNFIFdIRU4gcDFhX3dlZWtseV9kaWZmX3BlcmNlbnRhZ2UgSVMgTlVMTCBUSEVOIEVSUk9SKFxuICAgIENPTkNBVChcbiAgICAgICdPbiAnLFxuICAgICAgZGF0ZSxcbiAgICAgICcgdGhlIGRpZmZlcmVuY2UgYmV0d2VlbiB0aGlzIHdlZWsgYW5kIGxhc3Qgd2VlayBtZXRyaWNzIHdhcyBub3QgY2FsY3VsYXRlZCAnXG4gICAgKVxuICApXG4gIFdIRU4gcDFhX3dlZWtseV9kaWZmX3BlcmNlbnRhZ2UgXHUwMDNlIDEgVEhFTiBFUlJPUihcbiAgICBDT05DQVQoXG4gICAgICAnT24gJyxcbiAgICAgIGRhdGUsXG4gICAgICAnIHRoZSBkaWZmZXJlbmNlIGJldHdlZW4gdGhpcyB3ZWVrIGFuZCBsYXN0IHdlZWsgbWV0cmljcyBpcyBvZiAnLFxuICAgICAgcDFhX3dlZWtseV9kaWZmX3BlcmNlbnRhZ2UsXG4gICAgICAnJSdcbiAgICApXG4gICkgRUxTRSBwMWFfd2Vla2x5X2RpZmZfcGVyY2VudGFnZSBFTkRcbkZST01cbiAgKFxuICAgIFNFTEVDVFxuICAgICAgREFURV9BREQoQHJ1bl9kYXRlLCBJTlRFUlZBTCAtMSBEQVkpIEFTIGRhdGUsXG4gICAgICB3LnAxYV93ZWVrbHlfZGlmZl9wZXJjZW50YWdlXG4gICAgRlJPTVxuICAgICAgYHdwZS1wbGF0Zm9ybS1vbmUtZGV2LmNyb25fbW9uaXRvcmluZy5kYWlseV91c2FnZV9tZXRyaWNzX3N1bW1hcnlgIEFTIHdcbiAgICBXSEVSRVxuICAgICAgdy5kYXRlID0gREFURV9BREQoQHJ1bl9kYXRlLCBJTlRFUlZBTCAtMSBEQVkpXG4gICk7XG4iLAogICAgIndyaXRlX2Rpc3Bvc2l0aW9uIjogIldSSVRFX0FQUEVORCIKICB9LAogICJydW5UaW1lIjogIjIwMjMtMDQtMDRUMjA6MTM6MDguNDExWiIsCiAgInNjaGVkdWxlVGltZSI6ICIyMDIzLTA0LTA0VDIwOjEzOjA4LjgxMDFaIiwKICAic3RhcnRUaW1lIjogIjIwMjMtMDQtMDRUMjA6MTM6MDguOTMxOTMzWiIsCiAgInN0YXRlIjogIkZBSUxFRCIsCiAgInVwZGF0ZVRpbWUiOiAiMjAyMy0wNC0wNFQyMDoxNDoyMy45OTQxNzJaIiwKICAidXNlcklkIjogIjM4NDMwMTg1NTk0MTMyMjEwMTIiCn0K","messageId":"7345694962516196","message_id":"7345694962516196","publishTime":"2023-04-04T20:14:24.077Z","publish_time":"2023-04-04T20:14:24.077Z"},"subscription":"projects/wpe-platform-one-dev/subscriptions/bigquery-slack-notifier"}' | http post localhost:8080